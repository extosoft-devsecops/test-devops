# Default values for test-devops
# This configuration is optimized for Docker Desktop Kubernetes
# For production use, adjust resources, replicas, and enable autoscaling

# =============================================================================
# Application Configuration
# =============================================================================

# Number of pod replicas
replicaCount: 1

# Docker image configuration
image:
  # For Docker Desktop, use local image: test-devops
  # For GKE/production, use: asia-southeast1-docker.pkg.dev/test-devops-478606/test-devops-images/test-devops
  repository: test-devops
  tag: latest
  pullPolicy: IfNotPresent

# Kubernetes Service configuration
service:
  type: NodePort          # NodePort for Docker Desktop, LoadBalancer for cloud
  port: 3000              # Application port
  nodePort: 30080        # Fixed NodePort (30000-32767) for easy local access

# Application environment variables
env:
  serviceName: test-devops   # Service identifier
  nodeEnv: local            # Environment: local, dev, staging, production
  enableMetrics: "true"     # Enable metrics logging
  ddAgentHost: localhost    # Datadog Agent host (auto-set when datadog.enabled=true)
  ddDogstatsdPort: "8125"  # DogStatsD port

# Resource limits and requests
# For production, increase based on actual usage
resources:
  limits:
    cpu: 200m           # Maximum CPU (0.2 cores)
    memory: 256Mi       # Maximum memory
  requests:
    cpu: 50m            # Guaranteed CPU (0.05 cores)
    memory: 64Mi        # Guaranteed memory

# Health check probes
healthcheck:
  liveness:
    enabled: true
    path: /healthz                 # Health check endpoint
    initialDelaySeconds: 10        # Wait before first check
    periodSeconds: 10              # Check interval
    timeoutSeconds: 5              # Request timeout
    failureThreshold: 3            # Failures before restart
  readiness:
    enabled: true
    path: /healthz                 # Readiness check endpoint
    initialDelaySeconds: 5         # Wait before first check
    periodSeconds: 5               # Check interval
    timeoutSeconds: 3              # Request timeout
    failureThreshold: 3            # Failures before marking not ready

# Horizontal Pod Autoscaler (HPA)
autoscaling:
  enabled: false                   # Enable/disable HPA
  minReplicas: 1                  # Minimum number of replicas
  maxReplicas: 10                 # Maximum number of replicas
  targetCPUUtilizationPercentage: 80    # CPU threshold for scaling
  targetMemoryUtilizationPercentage: 80 # Memory threshold for scaling

# =============================================================================
# Datadog Agent Configuration
# =============================================================================

datadog:
  # Enable/disable Datadog monitoring
  # Set to false for local development without monitoring
  enabled: false
  
  # Datadog API Key (required if enabled=true)
  # Get from: https://app.datadoghq.com/organization-settings/api-keys
  # Set via: --set datadog.apiKey=<YOUR_KEY>
  apiKey: ""
  
  # Datadog site (depends on your region)
  # Options: datadoghq.com (US), datadoghq.eu (EU), etc.
  site: "datadoghq.com"

  agent:
    image:
      repository: gcr.io/datadoghq/agent
      tag: "7"
      pullPolicy: IfNotPresent

    resources:
      limits:
        cpu: 200m
        memory: 512Mi
      requests:
        cpu: 100m
        memory: 256Mi

    # DogStatsD configuration
    dogstatsd:
      enabled: true
      port: 8125
      useHostPort: true
      nonLocalTraffic: true

    # APM configuration
    apm:
      enabled: false
      port: 8126

    # Log collection
    logs:
      enabled: true
      containerCollectAll: true

    # Process monitoring
    processAgent:
      enabled: false

# =============================================================================
# Prometheus Monitoring (Optional)
# =============================================================================

prometheus:
  # Enable/disable Prometheus ServiceMonitor
  # Requires Prometheus Operator to be installed
  enabled: false
  
  serviceMonitor:
    # Metrics endpoint path
    path: /metrics
    
    # Scrape interval
    interval: 30s
    
    # Scrape timeout
    scrapeTimeout: 10s
    
    # Additional labels for ServiceMonitor selector
    additionalLabels: {}
      # prometheus: kube-prometheus

